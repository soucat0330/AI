<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fluid Planner Prototype</title>
    <style>
        :root {
            --primary: #6C63FF;
            --secondary: #FF6584;
            --bg: #F0F4F8;
            --card-bg: #FFFFFF;
            --text: #2D3748;
            --muted: #A0AEC0;
            --fluid-ease: cubic-bezier(0.25, 1, 0.5, 1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .app-container {
            width: 100%;
            max-width: 400px;
            background: #fff;
            border-radius: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Header */
        header {
            padding: 24px;
            background: linear-gradient(135deg, #6C63FF 0%, #a18aff 100%);
            color: white;
        }

        h1 { margin: 0; font-size: 1.5rem; }
        p { margin: 5px 0 0; opacity: 0.9; font-size: 0.9rem; }

        /* Input Area */
        .input-area {
            padding: 20px;
            background: #fff;
            border-bottom: 1px solid #eee;
            z-index: 10;
        }

        .input-group { display: flex; gap: 10px; margin-bottom: 10px; }
        
        input, select {
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 12px;
            font-size: 14px;
            width: 100%;
            outline: none;
            transition: border-color 0.3s;
        }
        input:focus { border-color: var(--primary); }

        button#add-btn {
            width: 100%;
            padding: 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.1s;
        }
        button#add-btn:active { transform: scale(0.98); }

        /* Timeline (Stream) */
        .timeline-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: linear-gradient(to bottom, #fff 0%, #f7f9fc 100%);
            position: relative;
        }

        /* Vertical Line */
        .stream-line {
            position: absolute;
            left: 40px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e2e8f0;
            z-index: 0;
        }

        /* Task Cards */
        .task-card {
            background: var(--card-bg);
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
            z-index: 1;
            /* Fluid Animation */
            transition: all 0.6s var(--fluid-ease);
            transform-origin: top center;
            opacity: 0;
            transform: translateY(20px) scale(0.95);
            animation: popIn 0.5s var(--fluid-ease) forwards;
        }

        @keyframes popIn {
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .task-time {
            font-size: 0.8rem;
            color: var(--muted);
            font-weight: bold;
            min-width: 45px;
            text-align: right;
        }

        .task-content { flex: 1; }
        
        .task-title { font-weight: bold; margin-bottom: 4px; }
        .task-meta { font-size: 0.75rem; color: var(--muted); display: flex; gap: 8px; }

        /* Status Colors */
        .priority-high { border-left: 4px solid var(--secondary); }
        .priority-normal { border-left: 4px solid var(--primary); }
        .priority-low { border-left: 4px solid #4FD1C5; }

        /* Current Task Highlight */
        .task-card.is-current {
            background: #F3F0FF;
            border: 2px solid var(--primary);
            transform: scale(1.02);
            box-shadow: 0 8px 20px rgba(108, 99, 255, 0.2);
        }

        /* Feedback Control (Bottom Sheet) */
        .feedback-controls {
            padding: 20px;
            background: #fff;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
            justify-content: space-between;
            align-items: center;
        }

        .feedback-btn {
            padding: 10px 16px;
            border-radius: 20px;
            border: none;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }

        .btn-delay { background: #FED7D7; color: #C53030; }
        .btn-complete { background: #C6F6D5; color: #2F855A; }
        
        .btn-delay:hover { background: #FEB2B2; transform: translateY(-2px); }
        .btn-complete:hover { background: #9AE6B4; transform: translateY(-2px); }

        /* Empty State */
        .empty-state {
            text-align: center;
            color: var(--muted);
            margin-top: 50px;
        }

    </style>
</head>
<body>

<div class="app-container">
    <header>
        <h1>Fluid Planner</h1>
        <p>AI Dynamic Scheduling</p>
    </header>

    <div class="input-area">
        <div class="input-group">
            <input type="text" id="taskInput" placeholder="æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’å…¥åŠ›..." />
        </div>
        <div class="input-group">
            <select id="durationInput">
                <option value="15">15åˆ†</option>
                <option value="30" selected>30åˆ†</option>
                <option value="60">60åˆ†</option>
                <option value="90">90åˆ†</option>
            </select>
            <select id="priorityInput">
                <option value="normal">é€šå¸¸</option>
                <option value="high">é«˜å„ªå…ˆ (AIå„ªå…ˆ)</option>
                <option value="low">ä½å„ªå…ˆ</option>
            </select>
        </div>
        <button id="add-btn" onclick="addTask()">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã«è¿½åŠ  (AI)</button>
    </div>

    <div class="timeline-container">
        <div class="stream-line"></div>
        <div id="taskList">
            <div class="empty-state">ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚<br>AIãŒæœ€é©ãªæµã‚Œã‚’ä½œã‚Šã¾ã™ã€‚</div>
        </div>
    </div>

    <div class="feedback-controls">
        <span style="font-size: 0.8rem; font-weight: bold; color: var(--muted);">AI Feedback:</span>
        <button class="feedback-btn btn-delay" onclick="triggerDelay()">+15åˆ† æŠ¼ã—</button>
        <button class="feedback-btn btn-complete" onclick="completeCurrent()">å®Œäº†</button>
    </div>
</div>

<script>
    // State
    let tasks = [];
    let baseTime = new Date(); 
    // ã‚¹ã‚¿ãƒ¼ãƒˆæ™‚é–“ã‚’ç¾åœ¨ã®ç›´è¿‘ã®00åˆ†ã‹30åˆ†ã«ä¸¸ã‚ã‚‹
    baseTime.setMinutes(baseTime.getMinutes() > 30 ? 30 : 0);
    baseTime.setSeconds(0);

    // AI Logic Simulator
    function runAIScheduler() {
        // AIãƒ­ã‚¸ãƒƒã‚¯: 
        // 1. "High"å„ªå…ˆåº¦ã®ã‚¿ã‚¹ã‚¯ã‚’å…ˆã«æŒã£ã¦ãã‚‹ï¼ˆå˜ç´”ãªã‚½ãƒ¼ãƒˆï¼‰
        // 2. ã—ã‹ã—ã€ãƒªã‚¹ãƒˆã®æœ€åˆã®ã‚¿ã‚¹ã‚¯ãŒã€Œç¾åœ¨é€²è¡Œä¸­ã€ã®å ´åˆã¯å‹•ã‹ã•ãªã„
        
        const currentTask = tasks.length > 0 ? tasks[0] : null;
        const waitingTasks = tasks.slice(1);

        // å„ªå…ˆåº¦ã‚¹ã‚³ã‚¢: high=3, normal=2, low=1
        const getScore = (p) => p === 'high' ? 3 : (p === 'normal' ? 2 : 1);

        // ã‚½ãƒ¼ãƒˆå®Ÿè¡Œï¼ˆAIãŒè€ƒãˆã¦ã„ã‚‹ãƒ•ãƒªï¼‰
        waitingTasks.sort((a, b) => getScore(b.priority) - getScore(a.priority));

        // å†çµåˆ
        if (currentTask) {
            tasks = [currentTask, ...waitingTasks];
        } else {
            tasks = waitingTasks;
        }

        // æ™‚é–“ã®å†è¨ˆç®— (Recalculate Timeline)
        let currentTimeCursor = new Date(baseTime);
        
        tasks.forEach((task, index) => {
            task.startTime = new Date(currentTimeCursor);
            // æ™‚é–“ã‚’é€²ã‚ã‚‹
            currentTimeCursor.setMinutes(currentTimeCursor.getMinutes() + parseInt(task.duration));
            task.endTime = new Date(currentTimeCursor);
        });

        renderTasks();
    }

    // Add Task
    function addTask() {
        const titleInput = document.getElementById('taskInput');
        const durationInput = document.getElementById('durationInput');
        const priorityInput = document.getElementById('priorityInput');

        if (!titleInput.value) return;

        const newTask = {
            id: Date.now(),
            title: titleInput.value,
            duration: parseInt(durationInput.value),
            priority: priorityInput.value,
            startTime: null,
            endTime: null
        };

        tasks.push(newTask);
        
        // å…¥åŠ›ã‚¯ãƒªã‚¢
        titleInput.value = '';
        
        // AIã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œ
        runAIScheduler();
    }

    // Render Logic
    function renderTasks() {
        const container = document.getElementById('taskList');
        container.innerHTML = '';

        if (tasks.length === 0) {
            container.innerHTML = '<div class="empty-state">ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚<br>AIãŒæœ€é©ãªæµã‚Œã‚’ä½œã‚Šã¾ã™ã€‚</div>';
            return;
        }

        tasks.forEach((task, index) => {
            const isCurrent = index === 0;
            const timeStr = formatTime(task.startTime);
            const endTimeStr = formatTime(task.endTime);
            
            const div = document.createElement('div');
            div.className = `task-card priority-${task.priority} ${isCurrent ? 'is-current' : ''}`;
            
            div.innerHTML = `
                <div class="task-time">
                    <div>${timeStr}</div>
                    <div style="font-size:0.6rem; opacity:0.6;">${endTimeStr}</div>
                </div>
                <div class="task-content">
                    <div class="task-title">${task.title} ${isCurrent ? 'ğŸ”¥' : ''}</div>
                    <div class="task-meta">
                        <span>â± ${task.duration}åˆ†</span>
                        <span>${task.priority === 'high' ? 'âš¡ å„ªå…ˆ' : ''}</span>
                    </div>
                </div>
            `;
            container.appendChild(div);
        });
    }

    // Helper: Time Format
    function formatTime(date) {
        return date.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
    }

    // Feedback: Delay (+15min)
    function triggerDelay() {
        if (tasks.length === 0) return;

        // ç¾åœ¨ã®ã‚¿ã‚¹ã‚¯ï¼ˆå…ˆé ­ï¼‰ã®æ™‚é–“ã‚’å»¶ã°ã™
        tasks[0].duration += 15;
        
        // AIå†è¨ˆç®—ï¼ˆå¾Œç¶šã®ã‚¿ã‚¹ã‚¯ãŒè‡ªå‹•ã§ãšã‚Œã‚‹ï¼‰
        runAIScheduler();

        // ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆæœ¬æ¥ã¯ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ãªã©ï¼‰
        const btn = document.querySelector('.btn-delay');
        const originalText = btn.innerText;
        btn.innerText = "å†è¨ˆç®—ä¸­...";
        setTimeout(() => btn.innerText = originalText, 500);
    }

    // Feedback: Complete
    function completeCurrent() {
        if (tasks.length === 0) return;

        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã«è¦ç´ ã‚’å–å¾—ã—ã¦æ¶ˆã™æ¼”å‡ºï¼ˆç°¡æ˜“çš„ï¼‰
        const cards = document.querySelectorAll('.task-card');
        if(cards[0]) {
            cards[0].style.transform = "translateX(100px)";
            cards[0].style.opacity = "0";
        }

        setTimeout(() => {
            // ã‚¿ã‚¹ã‚¯å‰Šé™¤
            tasks.shift();
            // é–‹å§‹æ™‚é–“ã‚’ç¾åœ¨æ™‚åˆ»ã«ãƒªã‚»ãƒƒãƒˆï¼ˆæ¬¡ã®ã‚¿ã‚¹ã‚¯ã‚’ä»Šã‹ã‚‰å§‹ã‚ã‚‹ï¼‰
            baseTime = new Date();
            // åˆ†ã‚’ä¸¸ã‚ã‚‹
            let m = baseTime.getMinutes();
            baseTime.setMinutes(m + (5 - m % 5)); // 5åˆ†åˆ‡ã‚Šä¸Šã’ãªã©

            runAIScheduler();
        }, 300);
    }
    
    // Enterã‚­ãƒ¼ã§è¿½åŠ 
    document.getElementById('taskInput').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') addTask();
    });

</script>

</body>
</html>
