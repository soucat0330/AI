<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>è¡Œå‹•å­¦ç¿’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼</title>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<style>
/* ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã¨ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ */
.timeline { position: relative; height: 160px; border: 1px solid var(--border-color); background: var(--timeline-bg); padding: 12px; border-radius: 10px; }
.timeline-row { position: relative; height: 36px; margin-bottom: 8px; }
.timeline-label { position: absolute; left: 0; top: 0; bottom: 0; width: 160px; display:flex;align-items:center;padding-left:8px;font-size:13px; color: var(--text-color); }
.timeline-track { position: absolute; left: 170px; right: 12px; top: 0; bottom: 0; }
.timeline-bar { position: absolute; height: 28px; top: 4px; border-radius: 6px; display:flex;align-items:center;padding-left:8px; font-weight:600; color: var(--bar-text-color); }
.calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
.calendar-cell { border: 1px solid var(--border-color); padding: 6px; border-radius: 6px; min-height: 60px; font-size: 12px; background: var(--cell-bg); color: var(--text-color); }
.calendar-cell h4 { font-weight: 600; margin-bottom: 4px; font-size: 12px; }

/* ãƒ†ãƒ¼ãƒå¤‰æ•° */
body.light { --bg-color:#f3f4f6; --text-color:#111827; --bg-card:#e5e7eb; --timeline-bg:#f9fafb; --border-color:rgba(0,0,0,0.1); --cell-bg:#e5e7eb; --bar-text-color:#000; }
body.dark { --bg-color:#1f2937; --text-color:#f9fafb; --bg-card:#374151; --timeline-bg:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); --border-color:rgba(255,255,255,0.06); --cell-bg:#374151; --bar-text-color:#001; }
body.blue { --bg-color:#1e3a8a; --text-color:#dbeafe; --bg-card:#3b82f6; --timeline-bg:#93c5fd33; --border-color:rgba(219,234,254,0.6); --cell-bg:#3b82f6; --bar-text-color:#001; }
body.mono { --bg-color:#e5e7eb; --text-color:#111827; --bg-card:#9ca3af; --timeline-bg:#d1d5db; --border-color:rgba(0,0,0,0.2); --cell-bg:#9ca3af; --bar-text-color:#000; }

/* ã‚«ãƒ¼ãƒ‰å…±é€š */
.card { background-color: var(--bg-card); color: var(--text-color); border-radius:0.5rem; padding:0.75rem; }
</style>
</head>
<body class="transition-colors duration-500 min-h-screen p-6 font-sans">
<div class="max-w-6xl mx-auto">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-2xl font-bold">è¡Œå‹•å­¦ç¿’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼</h1>
    <select id="themeSelect" class="p-2 rounded text-sm">
      <option value="dark">ãƒ€ãƒ¼ã‚¯</option>
      <option value="light">ãƒ©ã‚¤ãƒˆ</option>
      <option value="blue">ãƒ–ãƒ«ãƒ¼</option>
      <option value="mono">ãƒ¢ãƒã‚¯ãƒ­</option>
    </select>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
    <div class="card">
      <h2 class="font-semibold mb-2">ã‚¿ã‚¹ã‚¯è¿½åŠ </h2>
      <input id="title" class="w-full p-2 rounded mb-2" placeholder="ã‚¿ã‚¤ãƒˆãƒ«" />
      <input id="deadline" type="datetime-local" class="w-full p-2 rounded mb-2" />
      <select id="genre" class="w-full p-2 rounded mb-2">
        <option value="å‹‰å¼·">å‹‰å¼·</option>
        <option value="ä»•äº‹">ä»•äº‹</option>
        <option value="å®¶äº‹">å®¶äº‹</option>
      </select>
      <input id="subjective" type="number" class="w-full p-2 rounded mb-2" placeholder="ä¸»è¦³çš„é‡è¦åº¦(1-10)" />
      <input id="objective" type="number" class="w-full p-2 rounded mb-2" placeholder="å®¢è¦³çš„é‡è¦åº¦(1-10)" />
      <input id="duration" type="number" class="w-full p-2 rounded mb-2" placeholder="è¦‹ç©æ™‚é–“(åˆ†)" />
      <button id="addTask" class="w-full bg-blue-600 hover:bg-blue-500 py-2 rounded font-semibold">è¿½åŠ </button>

      <div class="mt-4">
        <h2 class="font-semibold mb-2">ã‚¿ã‚¹ã‚¯ä¸€è¦§</h2>
        <div id="taskList" class="space-y-2"></div>
      </div>
    </div>

    <div class="col-span-2 card">
      <h2 class="font-semibold mb-2">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç”Ÿæˆ</h2>
      <div class="flex gap-2 mb-3">
        <input id="date" type="date" class="p-2 rounded" />
        <button id="generate" class="bg-green-600 hover:bg-green-500 py-2 px-4 rounded font-semibold">ç”Ÿæˆ</button>
      </div>

      <div id="scheduleList" class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4"></div>

      <h3 class="font-medium mb-2">ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</h3>
      <div id="timeline" class="timeline mb-6"></div>

      <h3 class="font-medium mb-2">ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h3>
      <div id="calendar" class="calendar-grid"></div>
    </div>
  </div>

  <div class="card mt-4">
    <h2 class="font-semibold mb-2">ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯</h2>
    <div class="grid grid-cols-1 md:grid-cols-4 gap-2">
      <select id="feedbackTask" class="col-span-2 p-2 rounded"></select>
      <input id="actualDuration" type="number" placeholder="å®Ÿç¸¾æ™‚é–“(åˆ†)" class="p-2 rounded" />
      <select id="completed" class="p-2 rounded"><option value="1">å®Œäº†ã—ãŸ</option><option value="0">æœªå®Œäº†</option></select>
    </div>
    <div class="mt-3">
      <button id="saveFeedback" class="bg-yellow-500 hover:bg-yellow-400 py-2 px-4 rounded font-semibold">ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ä¿å­˜</button>
    </div>
  </div>
</div>

<script>
const STORAGE_KEY='behavior_scheduler_db_theme';
let db=JSON.parse(localStorage.getItem(STORAGE_KEY)||'{"tasks":[],"records":[],"theme":"dark"}');

const titleEl=document.getElementById('title');
const deadlineEl=document.getElementById('deadline');
const genreEl=document.getElementById('genre');
const subjectiveEl=document.getElementById('subjective');
const objectiveEl=document.getElementById('objective');
const durationEl=document.getElementById('duration');
const addBtn=document.getElementById('addTask');
const generateBtn=document.getElementById('generate');
const scheduleList=document.getElementById('scheduleList');
const timelineRoot=document.getElementById('timeline');
const feedbackTaskEl=document.getElementById('feedbackTask');
const actualDurationEl=document.getElementById('actualDuration');
const completedEl=document.getElementById('completed');
const saveFeedbackBtn=document.getElementById('saveFeedback');
const taskListEl=document.getElementById('taskList');
const themeSelect=document.getElementById('themeSelect');
const calendarEl=document.getElementById('calendar');

function saveDB(){ localStorage.setItem(STORAGE_KEY,JSON.stringify(db)); }
function escapeHtml(s){ return String(s).replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[c]); }
function applyTheme(th){ document.body.classList.remove('dark','light','blue','mono'); document.body.classList.add(th); db.theme=th; saveDB(); }

function renderTasksInFeedback(){
  feedbackTaskEl.innerHTML='';
  if(!db.tasks.length){ feedbackTaskEl.innerHTML='<option value="">ï¼ˆã‚¿ã‚¹ã‚¯ãªã—ï¼‰</option>'; return; }
  db.tasks.forEach((t,i)=>{ const opt=document.createElement('option'); opt.value=i; opt.textContent=t.title; feedbackTaskEl.appendChild(opt); });
}

function renderTaskList(){
  taskListEl.innerHTML='';
  if(!db.tasks.length){ taskListEl.innerHTML='<div class="text-gray-400 text-sm">ã‚¿ã‚¹ã‚¯ãŒã‚ã‚Šã¾ã›ã‚“</div>'; return; }
  db.tasks.forEach((t,i)=>{
    const card=document.createElement('div'); card.className='p-3 bg-gray-700 rounded flex justify-between items-center';
    const info=document.createElement('div'); info.innerHTML=`<div class="font-semibold">${escapeHtml(t.title)}</div>
      <div class="text-sm text-gray-300">æœŸé™: ${t.deadline||'æœªè¨­å®š'} / ã‚¸ãƒ£ãƒ³ãƒ«: ${t.genre}</div>`;
    const del=document.createElement('button'); del.textContent='å‰Šé™¤'; del.className='bg-red-600 hover:bg-red-500 px-2 py-1 rounded text-sm';
    del.onclick=()=>{ db.tasks.splice(i,1); saveDB(); renderTaskList(); renderTasksInFeedback(); renderCalendar(); };
    card.append(info,del); taskListEl.appendChild(card);
  });
}

// ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼
function renderCalendar(){
  calendarEl.innerHTML='';
  const now=new Date(),year=now.getFullYear(),month=now.getMonth();
  const first=new Date(year,month,1), last=new Date(year,month+1,0);
  const startDay=first.getDay(), days=last.getDate();
  for(let i=0;i<startDay;i++) calendarEl.appendChild(document.createElement('div'));
  for(let d=1; d<=days; d++){
    const cell=document.createElement('div'); cell.className='calendar-cell';
    const dateStr=`${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    cell.innerHTML=`<h4>${d}</h4>`;
    db.tasks.filter(t=>t.deadline.startsWith(dateStr)).forEach(t=>{ const item=document.createElement('div'); item.textContent='â€¢ '+t.title; item.className='text-xs truncate'; cell.appendChild(item); });
    calendarEl.appendChild(cell);
  }
}

// åˆæœŸåŒ–
applyTheme(db.theme); themeSelect.value=db.theme;
renderTaskList(); renderTasksInFeedback(); renderCalendar();

// ã‚¤ãƒ™ãƒ³ãƒˆ
themeSelect.onchange=()=>applyTheme(themeSelect.value);
addBtn.onclick=()=>{
  const t={title:titleEl.value.trim(), deadline:deadlineEl.value||'', genre:genreEl.value, subjective:+subjectiveEl.value||5, objective:+objectiveEl.value||5, duration:+durationEl.value||30};
  if(!t.title) return alert('ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›');
  db.tasks.push(t); db.records.push({task:t, completed:0, actualDuration:null}); saveDB();
  titleEl.value=deadlineEl.value=subjectiveEl.value=objectiveEl.value=durationEl.value='';
  renderTaskList(); renderTasksInFeedback(); renderCalendar();
};
</script>
</body>
</html>
